<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

  <!-- iOS support -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Feature Match" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  <!-- Android support -->
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#bb3a2a" />

  <title>Feature Match: Match the benefits to the customer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5c0bf;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #000000;
      text-align: center;
    }
    #game-board {
      display: grid;
      grid-template-columns: repeat(4, 160px);
      justify-items: center;
      grid-gap: 20px;
      margin-top: 20px;
    }
    .card {
      width: 160px;
      height: 140px;
      background-color: #ff7b67;
      border-radius: 12px;
      cursor: pointer;
      position: relative;
      perspective: 1000px;
      border: 2px solid white;
    }
    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      text-align: center;
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }
    .card.flipped .card-inner {
      transform: rotateY(180deg);
      cursor: default;
    }
    .card-front,
    .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 12px;
      backface-visibility: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      padding: 10px;
      box-sizing: border-box;
      color: white;
    }
    .card-front {
      background-color: #ff7b67;
      border: 2px solid white;
    }
    .card-front img {
      max-width: 100px;
      max-height: 40px;
      object-fit: contain;
    }
    .card-back {
      background-color: #ff7b67;
      border: 2px solid white;
      transform: rotateY(180deg);
      font-size: 12px;
      line-height: 1.3;
      text-align: center;
      display: flex !important;
      flex-direction: column !important;
      justify-content: flex-start !important;
      align-items: center !important;
      padding: 10px 8px !important;
      box-sizing: border-box !important;
      height: 100% !important;
      color: white !important;
    }
    .card-back img {
      width: 100%;
      height: auto;
      max-height: 35%;
      object-fit: contain;
      margin: 0 0 8px 0;
      border-radius: 8px;
      flex-shrink: 0;
    }
    #reset-btn, #show-leaderboard-btn {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #000000;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 10px;
    }
    #message {
      margin-top: 20px;
      font-size: 20px;
      color: green;
      text-align: center;
    }
    #timer-moves {
      margin-top: 10px;
      font-size: 16px;
      color: #333;
      text-align: center;
    }
    #submit-score-form {
      margin-top: 20px;
      display: none;
      flex-direction: column;
      align-items: center;
    }
    #submit-score-form input {
      padding: 8px;
      margin: 5px;
      border-radius: 4px;
      border: 1px solid #ccc;
      width: 200px;
      font-size: 14px;
    }
    #submit-score-form button {
      margin-top: 10px;
      padding: 8px 20px;
      font-size: 16px;
      background-color: #000;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    /* Leaderboard modal */
    #leaderboard-modal {
      display: none;
      position: fixed;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.3);
      max-width: 90vw;
      max-height: 80vh;
      overflow-y: auto;
      z-index: 9999;
    }
    #leaderboard-modal h2 {
      margin-top: 0;
    }
    #leaderboard-table {
      width: 100%;
      border-collapse: collapse;
    }
    #leaderboard-table th, #leaderboard-table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    #leaderboard-table th {
      background-color: #ff7b67;
      color: white;
    }
    #close-leaderboard-btn {
      margin-top: 10px;
      padding: 8px 20px;
      font-size: 16px;
      background-color: #000;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Feature Match: Match the benefits to the customer</h1>

  <div id="timer-moves">Time: 0 s | Moves: 0</div>

  <div id="game-board"></div>

  <div>
    <button id="reset-btn">Restart Game</button>
    <button id="show-leaderboard-btn">Show Leaderboard</button>
  </div>

  <div id="message"></div>

  <form id="submit-score-form">
    <input type="text" id="player-name" placeholder="Your Name" required />
    <input type="text" id="store-name" placeholder="Store Name" required />
    <button type="submit">Submit Score</button>
  </form>

  <div id="leaderboard-modal">
    <h2>Top 10 Leaderboard</h2>
    <table id="leaderboard-table">
      <thead>
        <tr>
          <th>#</th><th>Name</th><th>Store</th><th>Moves</th><th>Time (s)</th><th>Points</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="close-leaderboard-btn">Close</button>
  </div>

  <script>
    const smallerImages = ['ndr2.png', 'wwc2.png', 'acc2.png', 'scr2.png', 'lat2.png', 'ext2.png'];
    const pairsData = [
      {
        pairId: 1,
        front: { text: "Next day replacement", img: "assets/ndr1.png" },
        back: { text: "Jess is a beautician who uses her phone to book and check her customer's appointments", img: "assets/ndr2.png" }
      },
      {
        pairId: 2,
        front: { text: "Worldwide cover", img: "assets/wwc1.png" },
        back: { text: "Sarah loves travelling, when travelling her phone is her bank card and her boarding pass", img: "assets/wwc2.png" }
      },
      {
        pairId: 3,
        front: { text: "£300 of accessories included when purchased at the same time", img: "assets/acc1.png" },
        back: { text: "Pete is always on the go, and is always wearing his Apple watch and Airpods", img: "assets/acc2.png" }
      },
      {
        pairId: 4,
        front: { text: "Unlimited £25 screen replacements", img: "assets/scr1.png" },
        back: { text: "George's 5 year old son loves watching YouTube videos on George's phone and iPad", img: "assets/scr2.png" }
      },
      {
        pairId: 5,
        front: { text: "Loss and theft cover", img: "assets/lat1.png" },
        back: { text: "Harry is a delivery driver and his work often takes him to different cities including London", img: "assets/lat2.png" }
      },
      {
        pairId: 6,
        front: { text: "Extended warranty", img: "assets/ext1.png" },
        back: { text: "Paula shops in store because she likes peace of mind, she wants to keep her phone for as long as possible", img: "assets/ext2.png" }
      }
    ];

    let cards = [];
    let flippedCards = [];
    let matchedPairs = 0;
    const totalPairs = pairsData.length;

    const gameBoard = document.getElementById('game-board');
    const message = document.getElementById('message');
    const resetBtn = document.getElementById('reset-btn');
    const timerMovesDisplay = document.getElementById('timer-moves');
    const submitForm = document.getElementById('submit-score-form');
    const playerNameInput = document.getElementById('player-name');
    const storeNameInput = document.getElementById('store-name');
    const showLeaderboardBtn = document.getElementById('show-leaderboard-btn');
    const leaderboardModal = document.getElementById('leaderboard-modal');
    const leaderboardTableBody = document.querySelector('#leaderboard-table tbody');
    const closeLeaderboardBtn = document.getElementById('close-leaderboard-btn');

    let moves = 0;
    let timer = 0;
    let timerInterval = null;
    let gameStarted = false;

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function createCards() {
      cards = [];
      pairsData.forEach(pair => {
        cards.push({ ...pair.front, pairId: pair.pairId, type: 'front' });
        cards.push({ ...pair.back, pairId: pair.pairId, type: 'back' });
      });
      shuffle(cards);
    }

    function createCardElement(cardData) {
      const card = document.createElement('div');
      card.classList.add('card');
      card.dataset.pairId = cardData.pairId;
      card.dataset.type = cardData.type;

      const cardInner = document.createElement('div');
      cardInner.classList.add('card-inner');

      const front = document.createElement('div');
      front.classList.add('card-front');
      if (cardData.img) {
        const img = document.createElement('img');
        img.src = cardData.img;
        img.alt = cardData.text;
        front.appendChild(img);
      }
      const frontText = document.createElement('div');
      frontText.textContent = cardData.text;
      front.appendChild(frontText);

      const back = document.createElement('div');
      back.classList.add('card-back');
      if (cardData.img && smallerImages.includes(cardData.img.split('/').pop())) {
        // Smaller back image
        const img = document.createElement('img');
        img.src = cardData.img;
        img.alt = cardData.text;
        back.appendChild(img);
      }
      const backText = document.createElement('div');
      backText.textContent = cardData.text;
      back.appendChild(backText);

      cardInner.appendChild(front);
      cardInner.appendChild(back);
      card.appendChild(cardInner);

      card.addEventListener('click', () => handleCardClick(card));

      return card;
    }

    function handleCardClick(card) {
      if (flippedCards.length === 2 || card.classList.contains('flipped')) return;

      if (!gameStarted) {
        startTimer();
        gameStarted = true;
      }

      card.classList.add('flipped');
      flippedCards.push(card);

      if (flippedCards.length === 2) {
        moves++;
        updateTimerMoves();
        const [card1, card2] = flippedCards;
        if (
          card1.dataset.pairId === card2.dataset.pairId &&
          card1.dataset.type !== card2.dataset.type
        ) {
          matchedPairs++;
          flippedCards = [];
          if (matchedPairs === totalPairs) {
            endGame();
          }
        } else {
          setTimeout(() => {
            card1.classList.remove('flipped');
            card2.classList.remove('flipped');
            flippedCards = [];
          }, 1200);
        }
      }
    }

    function updateTimerMoves() {
      timerMovesDisplay.textContent = `Time: ${timer} s | Moves: ${moves}`;
    }

    function startTimer() {
      timerInterval = setInterval(() => {
        timer++;
        updateTimerMoves();
      }, 1000);
    }

    function stopTimer() {
      clearInterval(timerInterval);
    }

    function resetGame() {
      stopTimer();
      timer = 0;
      moves = 0;
      gameStarted = false;
      matchedPairs = 0;
      updateTimerMoves();
      message.textContent = '';
      submitForm.style.display = 'none';
      playerNameInput.value = '';
      storeNameInput.value = '';
      gameBoard.innerHTML = '';
      createCards();
      cards.forEach(cardData => {
        const cardElement = createCardElement(cardData);
        gameBoard.appendChild(cardElement);
      });
    }

    function calculatePoints(moves, time) {
      // Simple example: max 100 points - 2 points per move - 1 point per second, min 0
      let points = 100 - moves * 2 - time;
      if (points < 0) points = 0;
      return points;
    }

    function endGame() {
      stopTimer();
      message.textContent = `You completed the game in ${timer} seconds with ${moves} moves!`;
      submitForm.style.display = 'flex';
    }

    submitForm.addEventListener('submit', e => {
      e.preventDefault();
      const name = playerNameInput.value.trim();
      const store = storeNameInput.value.trim();

      if (!name || !store) {
        alert('Please enter both your name and store.');
        return;
      }

      const points = calculatePoints(moves, timer);

      const data = {
        name,
        store,
        moves,
        time: timer,
        points,
      };

      // Replace this with your actual Apps Script Web App URL
      const scriptURL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec';

      fetch(scriptURL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      }).then(() => {
        message.textContent = `Thanks ${name}! Your score has been submitted.`;
        submitForm.style.display = 'none';
      }).catch(() => {
        alert('Error submitting score. Please try again.');
      });
    });

    showLeaderboardBtn.addEventListener('click', () => {
      // Replace with your Google Apps Script Web App URL (same as for submit)
      const scriptURL = https://script.google.com/macros/s/AKfycbwegOLFu7OblOk8Qge7TJ9FxHyuxzoAyI9HZ7DFWCV6a0vqFtKaD02KUsJx20bEDDC9KA/exec;

      fetch(scriptURL)
        .then(response => response.json())
        .then(data => {
          leaderboardTableBody.innerHTML = ''; // Clear old rows
          data.forEach((entry, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${index + 1}</td>
              <td>${entry.name}</td>
              <td>${entry.store}</td>
              <td>${entry.moves}</td>
              <td>${entry.time}</td>
              <td>${entry.points}</td>
            `;
            leaderboardTableBody.appendChild(row);
          });
          leaderboardModal.style.display = 'block';
        })
        .catch(() => {
          alert('Could not load leaderboard. Please try again later.');
        });
    });

    closeLeaderboardBtn.addEventListener('click', () => {
      leaderboardModal.style.display = 'none';
    });

    resetBtn.addEventListener('click', resetGame);

    // Initialize game on load
    resetGame();
  </script>
</body>
</html>
